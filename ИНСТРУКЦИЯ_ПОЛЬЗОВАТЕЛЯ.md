# 📖 ИНСТРУКЦИЯ ПОЛЬЗОВАТЕЛЯ: WorkerNet Installer v5.0

> **Простое руководство по установке WorkerNet**  
> **Для администраторов и пользователей**

---

## 🚀 БЫСТРЫЙ СТАРТ

### ⚠️ Предварительно: Проверка curl

```bash
# Проверить curl
curl --version

# Если curl не установлен
sudo apt update && sudo apt install -y curl  # Debian/Ubuntu
sudo dnf install -y curl                      # AlmaLinux
```

### Способ 1: Быстрая установка (с настройками по умолчанию)

```bash
# Одна команда для полной установки
curl -O http://workernet.online/WN_5.0_install/bootstrap.sh && \
chmod +x bootstrap.sh && \
sudo ./bootstrap.sh
```

**При запросе "Запустить установку сейчас?" → ответьте `y`**

**Что произойдет:**
1. Загрузит установщик
2. Спросит версию (3.x / 4.x / 5.x)
3. Спросит веб-сервер (Apache / NGINX)
4. Спросит домен (по умолчанию или свой)
5. Покажет параметры для подтверждения
6. Установит WorkerNet автоматически

**Время установки:** ~15-30 минут

---

### Способ 2: Установка с настройкой конфигурации

**Если нужно настроить дополнительные параметры:**

```bash
# 1. Загрузить инсталлятор
curl -O http://workernet.online/WN_5.0_install/bootstrap.sh && \
chmod +x bootstrap.sh && \
sudo ./bootstrap.sh

# При запросе "Запустить установку сейчас?" → ответьте: n

# 2. Перейти в директорию инсталлятора
cd workernet_installer_v5

# 3. Скопировать пример конфигурации
cp install.conf.example.yml install.conf.yml

# 4. Настроить конфигурацию
nano install.conf.yml  # или vim, mcedit

# 5. Запустить установку с конфигом
sudo ./install.sh --config install.conf.yml
```

**Основные параметры в `install.conf.yml`:**
- `domain` - доменное имя сервера
- `webserver` - Apache или NGINX
- `database.password` - пароль PostgreSQL (авто-генерируется если пусто)
- `redis.password` - пароль Redis
- `modules` - список дополнительных модулей
- `firewall.enabled` - включить firewall правила
- `logging.level` - уровень логирования (DEBUG/INFO)

---

## 📋 ИНТЕРАКТИВНЫЕ ВОПРОСЫ

### Вопрос 1: Выбор версии

```
════════════════════════════════════════════════════════════════
  ВЫБОР ВЕТКИ WORKERNET
════════════════════════════════════════════════════════════════

  1) WorkerNet 3.x
     Стабильная версия (Legacy)
     PHP 8.3, PostgreSQL 15-16, Python 3.8+, 14 модулей

  2) WorkerNet 4.x  ⭐ РЕКОМЕНДУЕТСЯ
     Текущая стабильная
     PHP 8.3, PostgreSQL 16, Python 3.9+, 11 модулей

  3) WorkerNet 5.x
     Новая версия с React + Go (В разработке)

Введите номер версии: _
```

**Что выбрать:**
- **4.x** - для большинства случаев (рекомендуется)
- **3.x** - если нужна старая версия
- **5.x** - для тестирования новых функций

---

### Вопрос 2: Выбор веб-сервера

```
════════════════════════════════════════════════════════════════
  🌐 ВЫБОР ВЕБ-СЕРВЕРА
════════════════════════════════════════════════════════════════

  1) Apache
     - Стабильный, популярный
     - Поддержка .htaccess
     - Рекомендуется для большинства случаев

  2) NGINX
     - Быстрый, современный
     - Меньше потребление памяти
     - Отличная производительность

  3) Выход

Введите номер опции (1-3): _
```

**Что выбрать:**
- **Apache** (1) - если не знаете что выбрать
- **NGINX** (2) - если нужна производительность

---

### Вопрос 3: Настройка домена

```
════════════════════════════════════════════════════════════════
  🏠 НАСТРОЙКА ДОМЕНА
════════════════════════════════════════════════════════════════

IP-адреса сетевых интерфейсов:
  - 192.168.1.100

  1) default
     По умолчанию для всех доменов (рекомендуется)
     Будет использован: _

  2) custom
     Указать конкретное доменное имя или IP адрес

  3) Выход

Введите номер опции (1-3): _
```

**Что выбрать:**
- **default** (1) - для локальной установки или если доступ по IP
- **custom** (2) - если есть доменное имя (например: `workernet.ru`)

---

### Вопрос 4: Подтверждение параметров

```
════════════════════════════════════════════════════════════════
  📋 ПОДТВЕРЖДЕНИЕ ПАРАМЕТРОВ
════════════════════════════════════════════════════════════════

  Версия WorkerNet:        4.x
  Префикс модулей:         wnm_*
  Веб-сервер:              apache
  Домен:                   _
  Директория установки:    /var/www/workernet
  Операционная система:    ubuntu 24

════════════════════════════════════════════════════════════════

Продолжить установку с этими параметрами? (y/n): _
```

**Что нажать:**
- **y** - если все правильно, начать установку
- **n** - если нужно изменить, установка отменится

---

## 🎯 СПОСОБЫ УСТАНОВКИ

### 1. Полностью интерактивная (для начинающих)

```bash
sudo ./install.sh
```

**Особенности:**
- ✅ Покажет все вопросы
- ✅ Подскажет что выбрать
- ✅ Подходит для первой установки

---

### 2. С параметрами (для опытных)

```bash
sudo ./install.sh --version 4.x --webserver apache --domain workernet.ru
```

**Особенности:**
- ✅ Пропустит вопросы (использует параметры)
- ✅ Быстрая установка
- ✅ Подходит для повторной установки

**Доступные параметры:**
- `--version 4.x` - версия (3.x, 4.x, 5.x)
- `--webserver apache` - веб-сервер (apache, nginx)
- `--domain workernet.ru` - домен или IP
- `--force` - переустановка без вопросов

---

### 3. С конфигурационным файлом (для автоматизации)

```bash
# 1. Создать конфиг
cp install.conf.example.yml install.conf.yml
nano install.conf.yml

# 2. Запустить установку
sudo ./install.sh --config install.conf.yml
```

**Файл install.conf.yml:**
```yaml
# WorkerNet Installer Configuration
workernet:
  version: "4.x"      # 3.x, 4.x, 5.x
  domain: "workernet.example.com"
  webserver: "apache" # apache или nginx
  install_dir: "/var/www/workernet"

database:
  name: "workernet"
  user: "root"
  locale: "ru_RU.UTF-8"
```

**Особенности:**
- ✅ Все параметры в одном файле
- ✅ Если что-то пропущено - спросит интерактивно
- ✅ Подходит для множественных установок

---

## 🔄 КАК РАБОТАЮТ ПРИОРИТЕТЫ

### Порядок применения настроек (от высшего к низшему):

```
1. Параметры командной строки (--webserver nginx)
   ↓ Если не указаны
2. Интерактивный выбор (ваш ответ на вопросы)
   ↓ Если пропустили вопросы
3. Конфигурационный файл (install.conf.yml)
   ↓ Если нет в конфиге
4. Значения по умолчанию (apache, _)
```

### Примеры:

**Пример 1: Параметр + Конфиг**
```bash
# Конфиг: webserver: apache
sudo ./install.sh --webserver nginx --config install.conf.yml

# Результат: NGINX (параметр важнее конфига)
```

**Пример 2: Конфиг + Интерактив**
```bash
# Конфиг: webserver: apache
sudo ./install.sh --config install.conf.yml
# В интерактиве выбираете: NGINX

# Результат: NGINX (ваш выбор важнее конфига)
```

**Пример 3: Конфиг как fallback**
```bash
# Конфиг: webserver: apache, domain: example.com
sudo ./install.sh --config install.conf.yml
# В интерактиве: пропускаете все (нажимаете Enter)

# Результат: apache и example.com (из конфига)
```

---

## ⚙️ СИСТЕМНЫЕ ТРЕБОВАНИЯ

### Минимальные:

- **ОС:** Ubuntu 24.04 / Debian 12 / AlmaLinux 9
- **CPU:** 2 ядра
- **RAM:** 4 GB
- **Диск:** 50 GB свободного места
- **Права:** root доступ

### Рекомендуемые:

- **ОС:** Ubuntu 24.04 LTS
- **CPU:** 4 ядра
- **RAM:** 8 GB
- **Диск:** 100 GB SSD
- **Сеть:** Доступ в интернет

---

## 🛠️ ДОПОЛНИТЕЛЬНЫЕ ОПЦИИ

### Переустановка

```bash
# Если WorkerNet уже установлен
sudo ./install.sh --force

# Спросит: "Переустановить?" → Yes
# Или сразу переустановит с --force
```

### Пропустить проверки (НЕ РЕКОМЕНДУЕТСЯ)

```bash
sudo ./install.sh --skip-checks

# Пропустит проверки:
# - Свободное место на диске
# - Доступ в интернет
# - Занятость портов
# и т.д.
```

### DEBUG режим

```bash
sudo ./install.sh --debug

# Покажет подробные логи
# Полезно для диагностики проблем
```

---

## 📊 ПРОЦЕСС УСТАНОВКИ

### Этапы (автоматически):

1. ✅ **Pre-flight проверки** (11 проверок)
   - Свободное место (50+ GB)
   - RAM (4+ GB)
   - Права root
   - Доступ в интернет
   - Порты свободны
   - и другие...

2. ✅ **Установка PostgreSQL** + PostGIS
   - Версия 16
   - Локаль ru_RU.UTF-8
   - Расширение PostGIS

3. ✅ **Установка Redis** 7
   - Кеширование
   - Сессии

4. ✅ **Установка RabbitMQ** 3.x
   - Очереди задач
   - WebSocket для real-time

5. ✅ **Установка PHP** 8.3
   - Composer
   - Все расширения

6. ✅ **Установка Python** 3
   - Virtual environment
   - Зависимости для Poller

7. ✅ **Установка веб-сервера**
   - Apache или NGINX
   - Конфигурация

8. ✅ **Клонирование WorkerNet**
   - Из репозитория
   - Установка зависимостей

9. ✅ **Post-install конфигурация**
   - Supervisor
   - Crontab
   - Logrotate

10. ✅ **Smoke tests** (11 тестов)
    - Проверка PHP
    - Проверка БД
    - Проверка сервисов
    - Проверка прав доступа

---

## ✅ ПОСЛЕ УСТАНОВКИ

### Что вы получите:

```
✅ WorkerNet установлен в: /var/www/workernet
✅ Веб-интерфейс доступен: http://ваш-сервер/
✅ Все сервисы запущены:
   - PostgreSQL 16
   - Redis 7
   - RabbitMQ 3.x
   - Apache/NGINX
   - PHP 8.3
   - Supervisor
```

### Учетные данные:

```
════════════════════════════════════════════════════════════════
  УЧЕТНЫЕ ДАННЫЕ
════════════════════════════════════════════════════════════════

PostgreSQL:
  Пользователь: root
  Пароль: [сгенерирован автоматически]
  База данных: workernet

RabbitMQ:
  Admin: admin / [пароль]
  User: workernet / [пароль]
  WebSocket: workernet-stomp / [пароль]

Логи:
  /var/log/workernet-installer/install-YYYYMMDD-HHMMSS.log
  /var/log/workernet/

Директория:
  /var/www/workernet/
```

---

## 🆘 ПОМОЩЬ

### Если что-то пошло не так:

1. **Проверьте логи:**
   ```bash
   ls -la /var/log/workernet-installer/
   cat /var/log/workernet-installer/install-*.log
   ```

2. **Запустите smoke tests:**
   ```bash
   cd /tmp/workernet_installer
   sudo ./install.sh --skip-checks  # Пропустит проверки
   ```

3. **Переустановите:**
   ```bash
   sudo ./install.sh --force
   ```

### Частые проблемы:

**Проблема:** `curl: command not found`
```bash
# Решение: установить curl
sudo apt update && sudo apt install -y curl  # Debian/Ubuntu
sudo dnf install -y curl                      # AlmaLinux

# Проверка
curl --version

# Если нет sudo прав (user is not in the sudoers file):
su -
apt update && apt install -y curl  # или dnf install -y curl
exit
curl --version

# Альтернатива: использовать git
sudo apt install -y git  # или через root: su - && apt install -y git
git clone https://github.com/apelsin349/WN_5.0_install.git
cd WN_5.0_install
sudo ./install.sh
```

**Проблема:** Порты заняты (5432, 6379, 5672)
```bash
# Решение: использовать --force
sudo ./install.sh --force
```

**Проблема:** Недостаточно места
```bash
# Решение: очистить диск
sudo apt clean
sudo apt autoremove
df -h  # Проверить
```

**Проблема:** Нет доступа в интернет
```bash
# Решение: проверить сеть
ping -c 3 8.8.8.8
curl -I https://google.com
```

---

## 📞 КОНТАКТЫ

- 🌐 **Сайт:** https://workernet.online
- 📧 **Email:** support@workernet.online
- 📱 **Telegram:** @workernet_support
- 📚 **Документация:** https://docs.workernet.online

---

## 📖 ДОПОЛНИТЕЛЬНАЯ ДОКУМЕНТАЦИЯ

- **[README.md](README.md)** - Полное техническое руководство
- **[БЫСТРЫЙ_СТАРТ.md](БЫСТРЫЙ_СТАРТ.md)** - Быстрое начало
- **[ВЕРСИИ.md](ВЕРСИИ.md)** - Описание версий WorkerNet
- **[УДАЛЕННАЯ_УСТАНОВКА.md](УДАЛЕННАЯ_УСТАНОВКА.md)** - Bootstrap установка

---

## 🎯 ПОЛЕЗНЫЕ КОМАНДЫ

```bash
# Проверить статус сервисов
sudo systemctl status postgresql
sudo systemctl status redis
sudo systemctl status rabbitmq-server
sudo systemctl status apache2  # или nginx
sudo systemctl status supervisor

# Проверить логи
tail -f /var/log/workernet-installer/install-*.log

# Проверить версию WorkerNet
cat /var/www/workernet/VERSION

# Перезапустить сервисы
sudo systemctl restart apache2  # или nginx
sudo systemctl restart supervisor

# Проверить права доступа
ls -la /var/www/workernet/

# Показать учетные данные (если сохранены)
cat /var/log/workernet-installer/credentials.txt
```

---

**Версия инструкции:** 5.0  
**Обновлено:** 23 октября 2024  
**Статус:** Production-ready  

**Приятной установки! 🚀**

