# üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ò –õ–û–ö–ê–õ–ò POSTGRESQL

> **–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 23 –æ–∫—Ç—è–±—Ä—è 2025  
> **–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ —Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ PostgreSQL –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å —Ä—É—Å—Å–∫–æ–π –ª–æ–∫–∞–ª—å—é –Ω–∞ Debian 12

---

## üìã –ê–ù–ê–õ–ò–ó –û–®–ò–ë–ö–ò

### üö® –û—à–∏–±–∫–∞ –∏–∑ –ª–æ–≥–∞:

```
Error: The locale requested by the environment is invalid:
  LANG: en_US.UTF-8
  LANGUAGE: en_US:en
  LC_CTYPE: ru_RU.UTF-8
```

### üîç –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–°–º–µ—à–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–∫–∞–ª–∏** - —Å–∏—Å—Ç–µ–º–∞ –∏–º–µ–µ—Ç —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **–ù–µ–ø–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä—É—Å—Å–∫–æ–π –ª–æ–∫–∞–ª–∏** - –ª–æ–∫–∞–ª—å `ru_RU.UTF-8` –Ω–µ –±—ã–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ PostgreSQL

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `lib/database.sh:184-198`

```bash
# –ö–†–ò–¢–ò–ß–ù–û: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ª–æ–∫–∞–ª–∏
log_info "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ª–æ–∫–∞–ª–∏..."
export LANG=ru_RU.UTF-8
export LANGUAGE=ru_RU:ru
export LC_ALL=ru_RU.UTF-8
export LC_CTYPE=ru_RU.UTF-8
export LC_COLLATE=ru_RU.UTF-8
export LC_MESSAGES=ru_RU.UTF-8

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ª–æ–∫–∞–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞
if ! locale -a 2>/dev/null | grep -q "ru_RU.utf8\|ru_RU.UTF-8"; then
    log_error "–õ–æ–∫–∞–ª—å ru_RU.UTF-8 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ!"
    log_error "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ª–æ–∫–∞–ª—å –ø–µ—Ä–µ–¥ —Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫–ª–∞—Å—Ç–µ—Ä–∞"
    return 1
fi
```

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è pg_createcluster

**–§–∞–π–ª:** `lib/database.sh:218`

```bash
# –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä —Å —É—á–µ—Ç–æ–º –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–ª–∞–≥–∞ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if LANG=ru_RU.UTF-8 LC_ALL=ru_RU.UTF-8 pg_createcluster ${pg_version} main --port=5432 --locale=ru_RU.UTF-8 --encoding=UTF8 $no_start_flag 2>&1 | tee /tmp/pg_create.log | tail -10; then
```

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è initdb

**–§–∞–π–ª:** `lib/database.sh:246-247`

```bash
# –ü—Ä—è–º–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
sudo -u postgres env LANG=ru_RU.UTF-8 LC_ALL=ru_RU.UTF-8 /usr/lib/postgresql/${pg_version}/bin/initdb -D "$data_dir" \
    --locale=ru_RU.UTF-8 --encoding=UTF8 2>&1 | tail -10
```

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4: –£–ª—É—á—à–µ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª–∏

**–§–∞–π–ª:** `lib/database.sh:608-636`

```bash
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
if ! locale -a 2>/dev/null | grep -q "ru_RU.utf8\|ru_RU.UTF-8"; then
    log_warn "–õ–æ–∫–∞–ª—å –≤—Å–µ –µ—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã..."
    
    # –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å dpkg-reconfigure locales
    if command_exists dpkg-reconfigure; then
        log_info "–ü–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–∫–∞–ª–µ–π —á–µ—Ä–µ–∑ dpkg-reconfigure..."
        if [ -n "${LOG_FILE:-}" ]; then
            dpkg-reconfigure locales 2>&1 | tee -a "$LOG_FILE" | tail -5
        else
            dpkg-reconfigure locales 2>&1 | tail -5
        fi
    fi
    
    # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    if ! locale -a 2>/dev/null | grep -q "ru_RU.utf8\|ru_RU.UTF-8"; then
        log_error "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å ru_RU.UTF-8!"
        log_error "   –î–æ—Å—Ç—É–ø–Ω—ã–µ –ª–æ–∫–∞–ª–∏:"
        locale -a 2>/dev/null | grep -E "(ru|RU)" | head -5 || log_error "   –†—É—Å—Å–∫–∏–µ –ª–æ–∫–∞–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
        log_error ""
        log_error "üîß –†–ï–®–ï–ù–ò–ï:"
        log_error "   1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ª–æ–∫–∞–ª—å –≤—Ä—É—á–Ω—É—é:"
        log_error "      sudo apt-get install language-pack-ru"
        log_error "      sudo locale-gen ru_RU.UTF-8"
        log_error "   2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–∫–∞–ª—å"
        log_error ""
        return 1
    fi
fi
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞

```bash
bash -n lib/database.sh
# ‚úÖ OK
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª–∏** - —É–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞
2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
3. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### üéØ –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –†–µ—à–µ–Ω–∏–µ |
|----------|--------|---------|
| **–°–º–µ—à–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ª–æ–∫–∞–ª–∏** | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è |
| **–û—à–∏–±–∫–∞ pg_createcluster** | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | –ü–µ—Ä–µ–¥–∞—á–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ env |
| **–û—à–∏–±–∫–∞ initdb** | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | –ü–µ—Ä–µ–¥–∞—á–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ env |
| **–ù–µ–ø–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª–∏** | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ |

### üõ°Ô∏è –£–ª—É—á—à–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª–∏** –ø–µ—Ä–µ–¥ —Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫–ª–∞—Å—Ç–µ—Ä–∞
2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ PostgreSQL
3. **–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ª–æ–∫–∞–ª–∏
4. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã** —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ª–æ–∫–∞–ª–∏

---

## üîß –†–£–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä—É—Å—Å–∫—É—é –ª–æ–∫–∞–ª—å
sudo apt-get update
sudo apt-get install language-pack-ru
sudo locale-gen ru_RU.UTF-8

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É
locale -a | grep ru_RU

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export LANG=ru_RU.UTF-8
export LC_ALL=ru_RU.UTF-8

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É
sudo ./install.sh --force
```

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–û—à–∏–±–∫–∞ –ª–æ–∫–∞–ª–∏ PostgreSQL –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞!**

–¢–µ–ø–µ—Ä—å –∏–Ω—Å—Ç–∞–ª–ª—è—Ç–æ—Ä:
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç** —Ä—É—Å—Å–∫—É—é –ª–æ–∫–∞–ª—å
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –¥–ª—è PostgreSQL
- ‚úÖ **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ **–ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è** –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ –∏ –±–æ–ª—å—à–µ –Ω–µ –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–Ω–∏–∫–∞—Ç—å! üöÄ**

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 23 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–û–®–ò–ë–ö–ê –õ–û–ö–ê–õ–ò –ò–°–ü–†–ê–í–õ–ï–ù–ê**  
**–ö–∞—á–µ—Å—Ç–≤–æ:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê **PRODUCTION-READY**
